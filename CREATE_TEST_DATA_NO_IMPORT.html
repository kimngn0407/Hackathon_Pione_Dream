<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫°o Test Data Tr√™n Railway</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #333;
        }
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .info { color: #4444ff; }
        .warning { color: #ffaa00; }
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        .progress {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ T·∫°o Test Data Tr√™n Railway</h1>
        
        <div class="section">
            <h2>üìã B∆∞·ªõc 1: T·∫°o Admin Account</h2>
            <input type="email" id="adminEmail" placeholder="Email (admin@example.com)" value="admin@example.com">
            <input type="password" id="adminPassword" placeholder="Password" value="admin123">
            <input type="text" id="adminName" placeholder="T√™n" value="Admin">
            <button onclick="createAdmin()">T·∫°o Admin</button>
        </div>

        <div class="section">
            <h2>üåæ B∆∞·ªõc 2: T·∫°o Farm v√† Data</h2>
            <button onclick="createAllData()" id="createDataBtn" disabled>T·∫°o 1 Farm + 2 Fields + 4 Sensors + 2 Plants</button>
        </div>

        <div class="section">
            <h2>üìä Progress</h2>
            <div class="progress">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
        </div>

        <div class="log" id="log"></div>
    </div>

    <script>
        const API_BASE = 'https://hackathonpionedream-production.up.railway.app';
        let token = '';
        let userId = 0;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateProgress(percent) {
            const bar = document.getElementById('progressBar');
            bar.style.width = percent + '%';
            bar.textContent = percent + '%';
        }

        async function createAdmin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const name = document.getElementById('adminName').value;

            log('üîÑ ƒêang t·∫°o admin account...', 'info');
            log(`üì° Backend: ${API_BASE}`, 'info');

            try {
                log('üîÑ ƒêang g·ª≠i request...', 'info');
                const response = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        password: password,
                        fullName: name
                    })
                });

                log(`üìä Response status: ${response.status}`, 'info');
                
                if (!response.ok) {
                    const errorText = await response.text();
                    log(`‚ö†Ô∏è Response error: ${errorText}`, 'error');
                }

                const data = await response.json();

                if (response.ok && data.success) {
                    log('‚úÖ T·∫°o admin th√†nh c√¥ng!', 'success');
                    log('üîÑ ƒêang login...', 'info');
                    
                    // Auto login
                    const loginResponse = await fetch(`${API_BASE}/api/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });

                    const loginData = await loginResponse.json();

                    if (loginResponse.ok && loginData.success) {
                        token = loginData.data.token;
                        userId = loginData.data.user.id;
                        log(`‚úÖ Login th√†nh c√¥ng! Token: ${token.substring(0, 20)}...`, 'success');
                        log(`‚úÖ User ID: ${userId}`, 'success');
                        document.getElementById('createDataBtn').disabled = false;
                        updateProgress(25);
                    } else {
                        log('‚ùå Login th·∫•t b·∫°i: ' + loginData.error, 'error');
                    }
                } else {
                    log('‚ùå T·∫°o admin th·∫•t b·∫°i: ' + data.error, 'error');
                }
            } catch (error) {
                log('‚ùå L·ªñI K·∫æT N·ªêI: ' + error.message, 'error');
                log('', 'error');
                log('üîç NGUY√äN NH√ÇN C√ì TH·ªÇ:', 'warning');
                log('1. Backend Railway ƒëang down ho·∫∑c restart', 'warning');
                log('2. Network/Internet issue', 'warning');
                log('3. CORS policy blocking', 'warning');
                log('', 'warning');
                log('üí° GI·∫¢I PH√ÅP:', 'info');
                log('1. Ki·ªÉm tra Railway Dashboard xem backend c√≥ running kh√¥ng', 'info');
                log('2. Th·ª≠ refresh page v√† click l·∫°i', 'info');
                log('3. Ki·ªÉm tra console (F12) ƒë·ªÉ xem error chi ti·∫øt', 'info');
            }
        }

        async function createAllData() {
            if (!token) {
                log('‚ùå Ch∆∞a c√≥ token! T·∫°o admin tr∆∞·ªõc!', 'error');
                return;
            }

            log('üåæ B·∫Øt ƒë·∫ßu t·∫°o farm...', 'info');
            updateProgress(30);

            try {
                // Create Farm
                const farmResponse = await fetch(`${API_BASE}/api/farms`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        farmName: 'Test Farm 1',
                        ownerId: userId,
                        area: 10.5,
                        region: 'Test Region',
                        lat: 10.7769,
                        lng: 106.7009
                    })
                });

                const farm = await farmResponse.json();
                if (!farmResponse.ok) throw new Error('T·∫°o farm th·∫•t b·∫°i');
                
                log(`‚úÖ T·∫°o farm th√†nh c√¥ng! ID: ${farm.id}`, 'success');
                updateProgress(40);

                // Create Fields
                log('üèûÔ∏è ƒêang t·∫°o fields...', 'info');
                const fieldIds = [];

                for (let i = 1; i <= 2; i++) {
                    const fieldResponse = await fetch(`${API_BASE}/api/fields`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            farmId: farm.id,
                            fieldName: `Test Field ${i}`,
                            status: 'ACTIVE',
                            area: 5.0 + i,
                            region: `Region ${i}`
                        })
                    });

                    const field = await fieldResponse.json();
                    if (!fieldResponse.ok) throw new Error(`T·∫°o field ${i} th·∫•t b·∫°i`);
                    
                    fieldIds.push(field.id);
                    log(`‚úÖ T·∫°o field ${i} th√†nh c√¥ng! ID: ${field.id}`, 'success');
                }

                updateProgress(60);

                // Create Sensors
                log('üì° ƒêang t·∫°o sensors...', 'info');

                for (let i = 0; i < 4; i++) {
                    const fieldId = fieldIds[i % 2];
                    const sensorResponse = await fetch(`${API_BASE}/api/sensors`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            fieldId: fieldId,
                            sensorName: `Sensor ${i + 1}`,
                            type: i % 2 === 0 ? 'TEMPERATURE' : 'HUMIDITY',
                            status: 'ACTIVE',
                            lat: 10.7769 + (i * 0.001),
                            lng: 106.7009 + (i * 0.001),
                            pointOrder: i + 1
                        })
                    });

                    if (!sensorResponse.ok) throw new Error(`T·∫°o sensor ${i + 1} th·∫•t b·∫°i`);
                    log(`‚úÖ T·∫°o sensor ${i + 1} th√†nh c√¥ng!`, 'success');
                }

                updateProgress(80);

                // Create Plants
                log('üå± ƒêang t·∫°o plants...', 'info');
                const plants = ['Rice', 'Corn'];

                for (const plantName of plants) {
                    const plantResponse = await fetch(`${API_BASE}/api/plants`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            plantName: plantName,
                            description: `Test ${plantName}`
                        })
                    });

                    if (!plantResponse.ok) throw new Error(`T·∫°o plant ${plantName} th·∫•t b·∫°i`);
                    log(`‚úÖ T·∫°o plant ${plantName} th√†nh c√¥ng!`, 'success');
                }

                updateProgress(100);

                log('', 'info');
                log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'success');
                log('üéâ T·∫§T C·∫¢ DATA ƒê√É T·∫†O TH√ÄNH C√îNG!', 'success');
                log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'success');
                log('', 'info');
                log('üöÄ Test ngay:', 'warning');
                log('   https://hackathon-pione-dream.vercel.app/', 'warning');
                log(`   Email: ${document.getElementById('adminEmail').value}`, 'warning');
                log(`   Password: ${document.getElementById('adminPassword').value}`, 'warning');

            } catch (error) {
                log('‚ùå L·ªói: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>

